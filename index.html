<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>LINK ランニング費用</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    /* 页面基础设置 */
    body {
      font-family: 'Noto Sans', sans-serif;
      background: #f6f7f9;
      margin: 0;
      min-height: 100vh;
      color: #222;
      /* 保持居中，但把垂直对齐改成顶部对齐 */
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
      box-sizing: border-box;
    }

    /* 主卡片容器 */
    .container {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.08);

      /* 关键三行 */
      flex: 0 0 auto;  /* 关闭 flex 的自动拉伸 */
      width: auto;     /* 宽度随内容走 */
      display: inline-block;

      /* 其它属性 */
      min-width: 340px;
      padding: 24px 36px 36px 36px;
      position: relative;
    }    /* 结果区域 */
    .results-panel {
      background: #fff;
      width: 300px;
      padding: 24px;
      border-radius: 20px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.08);
      display: none;
      flex-direction: column;
      z-index: 100;
      text-align: left;
      transition: all 0.3s ease;
    }
    
    /* 媒体查询：大屏幕布局 (>= 1522px) */
    @media (min-width: 1522px) {
      .results-panel {
        position: absolute; /* 绝对定位 */
        left: calc(100% + 30px); /* 结果区域距离右侧的间距 */
        bottom: 0; /* 结果区域距离底部的间距 */ 
      }
    }
    
    /* 媒体查询：小屏幕布局 (< 1522px) */
    @media (max-width: 1521px) {
      .results-panel {
        position: absolute;
        top: calc(100% + 30px);
        right: 0; /* 与container右边缘对齐 */
      }
    }
    
    .results-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 16px;
      color: #333;
    }
      .results-group {
      margin-bottom: 16px;
    }
    
    .results-group-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: #444;
      padding-bottom: 4px;
      border-bottom: 1px solid #eee;
    }
    
    .results-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    
    .results-item.total {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #eee;
      font-weight: 700;
      font-size: 1.1rem;
    }
    /* 标题样式 */
    .main-title {
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 32px;
      letter-spacing: -1px;
      color: #181818;
      text-align: center;
    }
    .subtitle-note {
      font-size: 1rem;
      color: #7a869a;
      margin-bottom: 25px;
      margin-top: -25px;
      text-align: center;
    }
    /* 表单标签样式 */
    .item-row {
      display: inline-flex;
      justify-content: space-between;
      align-items: top;
      padding: 10px 0;
      border-bottom: 1px solid #ececec;
      width: 100%;
      gap: 16px;
    }
    .item-row:last-of-type {
      border-bottom: none;
    }
    .item-labels {
      text-align: left;
      flex: 1;
    }
    .item-title {
      font-size: 1rem;
      font-weight: 500;
      color: #222;
    }
    .item-desc {
      font-size: 0.95em;
      color: #8a94a6;
      font-weight: 400;
      line-height: 1.3;
      margin-top: 2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .item-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .item-price {
      font-size: 1.08em;
      color: #0071e3;
      font-weight: 600;
      white-space: nowrap;
      letter-spacing: 0.5px;
    }
    /* 数量选择器样式（仿亚马逊） */
    .quantity-selector {
      display: inline-flex;
      align-items: center;
      border: 1px solid #e5e5ea;
      border-radius: 20px;
      background: #f9f9fa;
      overflow: hidden;
      height: 30px;
      width: auto;
      min-width: 0;
      max-width: none;
    }
    .quantity-btn {
      width: 36px;
      height: 38px;
      border: none;
      background: none;
      font-size: 1.3em;
      color: #0071e3;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.15s;
      user-select: none;
    }
    .quantity-btn:active {
      background: #eaf0ff;
    }
    .quantity-input {
      width: 24px;
      border: none;
      background: transparent;
      text-align: center;
      font-size: 1rem;
      font-weight: 500;
      color: #181818;
      outline: none;
      padding: 0 4px;
    }
    .quantity-input::-webkit-outer-spin-button,
    .quantity-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    .quantity-input[type=number] {
      appearance: textfield;
      -moz-appearance: textfield;
    }
    /* 分组容器 */
    .group {
      padding: 24px 0 0 0;
      border-top: 1px solid #ececec;
      margin-top: 24px;
    }
    .group:first-of-type {
      border-top: none;
      padding-top: 0;
      margin-top: 0;
    }
    /* 分组标题 */
    .group-title {
      font-size: 1.13em;
      font-weight: 700;
      color: #222;
      margin-bottom: 14px;
      margin-top: 0;
      letter-spacing: -0.5px;
      padding-left: 2px;
      text-align: left;
    }
    /* 说明卡片 */
    .note-card {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      background: #f5f7fa;
      border-radius: 12px;
      padding: 16px 18px;
      margin: 36px 0 0 0;
      font-size: 1em;
      color: #4a5874;
      box-shadow: 0 2px 8px 0 rgba(90,110,140,0.04);
    }
    .note-card svg {
      flex-shrink: 0;
      width: 24px;
      height: 24px;
      margin-top: 2px;
      color: #0071e3;
      opacity: 0.85;
    }
    .note-card div {
      text-align: left;
    }
    /* 合計価格样式 */
    .price {
      font-size: 2.5rem;
      font-weight: 700;
      color: #0071e3;
      margin-top: 20px;
      letter-spacing: -1.5px;
      text-align: right;
    }
    /* 主体左右分栏布局 */
    .main-flex {
      display: flex;
      gap: 32px;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 36px;
    }
    .main-col {
      flex: 1 1 0;
      background: #f9f9fa;
      border-radius: 16px;
      box-shadow: 0 2px 8px 0 rgba(90,110,140,0.04);
      padding: 28px 24px 24px 24px; /* 恢复左右 padding，防止内容突破 */
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 0;
      width: 100%;
      max-width: 420px; /* 限制最大宽度，防止过宽 */
      box-sizing: border-box;
    }    /* SVG 插图样式 */
    .main-svg {
      width: 120px;
      height: 120px;
      margin-bottom: 24px;
      display: block;
      filter: drop-shadow(0 4px 16px rgba(0,113,227,0.10));
      /*border-radius: 16px;
      background: linear-gradient(135deg, #eaf0ff 60%, #fff 100%);*/
    }
    /* 响应式布局 */
    @media (max-width: 800px) {
      .main-flex { flex-direction: column; gap: 18px; }
      .main-col { width: 100%; }
      .container { width: 98vw; min-width: 0; }
      body { text-align: initial; }
    }
    
    /* 通知提示样式 */
    .notification {
      position: fixed;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      align-items: left;
      gap: 12px;
      background: #fff;
      border-radius: 10px;
      padding: 16px 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.15);
      max-width: 600px;
      width: auto;
      z-index: 1000;
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      pointer-events: none;
      align-items: center;
    }
    
    .notification.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
      pointer-events: auto;
    }
    
    .notification.hidden {
      opacity: 0;
      transform: translateX(-50%) translateY(20px);
    }
    
    .notification-icon {
      display: flex;
      align-items: center;
      justify-content: center;
      min-width: 32px;
      height: 32px;
      border-radius: 16px;
      background: #ffe9e9;
      color: #e74c3c;
    }
    
    .notification-message {
      font-size: 0.95rem;
      color: #333;
      text-align: left;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div class="container">
    <h1 class="main-title">LINK ランニング費用</h1>
    <div class="subtitle-note">本ページでは、月々のランニングコストのみを計算しており、導入費用は含まれておりません。</div>
    <div class="main-flex">
      <div class="main-col">
        <svg class="main-svg" viewBox="0 0 533 612" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M317.497 293.451L480.876 366.011" stroke="#898A8A" stroke-width="2.3765" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M18.6785 499.944L310.665 401.424C318.684 398.645 327.655 398.804 335.593 401.98L514.135 478.747C521.042 481.446 521.439 490.497 514.771 493.196L229.928 608.308C220.719 612.039 210.32 612.039 201.27 608.308L17.4082 515.663C9.62828 512.487 10.4222 502.802 18.6785 499.944Z" fill="#99B8BB"/>
          <path d="M265.736 558.05C266.291 569.403 258.353 579.326 247.953 580.041C237.474 580.835 228.582 572.102 228.106 560.591C227.63 549.159 235.648 539.394 245.968 538.68C256.368 538.124 265.18 546.698 265.736 558.05Z" fill="#221714"/>
          <path d="M486.91 468.517C487.465 479.87 479.527 489.793 469.127 490.507C458.648 491.301 449.756 482.569 449.28 471.058C448.804 459.626 456.822 449.861 467.142 449.147C477.462 448.591 486.274 457.165 486.91 468.517Z" fill="#221714"/>
          <path d="M507.468 406.273L506.595 441.124C506.754 444.141 505.166 447.158 501.831 448.587L219.53 567.112C210.241 571.002 199.762 571.082 190.712 567.35L5.58066 474.626C1.92884 473.118 0.182372 470.18 0.182372 467.163L0.0234392 429.534" fill="#CD2523"/>
          <path d="M6.6143 420.641L298.601 322.121C306.619 319.343 315.59 319.501 323.529 322.677L502.071 399.444C508.978 402.144 509.375 411.194 502.706 413.893L217.864 529.005C208.655 532.736 198.256 532.736 189.205 529.005L5.34407 436.36C-2.35651 433.263 -1.56261 423.499 6.6143 420.641Z" fill="#DB3C25"/>
          <path d="M24.3993 431.751C16.7781 427.702 18.4453 421.986 27.8924 418.89C37.3395 415.873 51.0735 416.508 58.6947 420.478C66.3953 424.447 65.1251 430.242 55.678 433.418C46.2309 436.514 32.0999 435.8 24.3993 431.751Z" fill="#CD2523"/>
          <path d="M62.3483 451.751C54.4095 447.543 55.7591 441.51 65.365 438.255C74.8915 435.08 88.9429 435.794 96.9611 439.843C105.059 443.971 104.027 450.005 94.4209 453.339C84.815 456.752 70.3664 456.038 62.3483 451.751Z" fill="#CD2523"/>
          <path d="M101.961 472.715C93.6252 468.269 94.7366 461.998 104.422 458.584C113.948 455.25 128.397 455.964 136.812 460.251C145.306 464.618 144.513 470.889 134.907 474.382C125.222 478.034 110.455 477.24 101.961 472.715Z" fill="#CD2523"/>
          <path d="M143.56 494.788C134.828 490.183 135.701 483.514 145.386 480.021C154.992 476.528 169.758 477.322 178.57 481.768C187.461 486.293 186.906 492.962 177.3 496.613C167.615 500.265 152.372 499.392 143.56 494.788Z" fill="#CD2523"/>
          <path d="M187.223 517.799C178.014 512.957 178.649 505.971 188.334 502.24C198.019 498.508 213.182 499.381 222.391 504.065C231.679 508.829 231.521 515.815 221.835 519.625C212.071 523.595 196.431 522.721 187.223 517.799Z" fill="#CD2523"/>
          <path d="M69.4903 416.898C61.7897 413.008 63.1393 407.451 72.2689 404.514C81.3984 401.576 94.8944 402.212 102.595 406.022C110.375 409.833 109.422 415.39 100.293 418.486C91.0837 421.502 77.2702 420.788 69.4903 416.898Z" fill="#CD2523"/>
          <path d="M107.679 436.195C99.6606 432.147 100.693 426.351 109.902 423.176C119.031 420.08 132.924 420.794 140.942 424.764C149.119 428.733 148.325 434.608 139.196 437.783C129.987 441.038 115.776 440.323 107.679 436.195Z" fill="#CD2523"/>
          <path d="M147.689 456.435C139.274 452.148 140.068 446.115 149.356 442.86C158.565 439.605 172.775 440.32 181.19 444.527C189.685 448.735 189.209 454.848 180 458.182C170.711 461.516 156.183 460.722 147.689 456.435Z" fill="#CD2523"/>
          <path d="M189.525 477.635C180.713 473.189 181.269 466.838 190.557 463.424C199.845 460.011 214.373 460.805 223.185 465.092C232.077 469.458 231.918 475.888 222.63 479.381C213.341 482.954 198.416 482.16 189.525 477.635Z" fill="#CD2523"/>
          <path d="M233.345 499.86C224.136 495.176 224.374 488.508 233.742 484.935C243.03 481.363 257.955 482.156 267.243 486.681C276.611 491.286 276.77 497.955 267.402 501.686C258.034 505.417 242.713 504.623 233.345 499.86Z" fill="#CD2523"/>
          <path d="M112.993 402.615C105.213 398.884 106.245 393.486 115.057 390.628C123.869 387.77 137.127 388.405 144.907 392.057C152.766 395.788 152.052 401.107 143.24 404.123C134.428 407.061 120.773 406.346 112.993 402.615Z" fill="#CD2523"/>
          <path d="M151.418 421.268C143.32 417.378 144.114 411.741 153.006 408.725C161.818 405.787 175.472 406.422 183.57 410.233C191.746 414.123 191.35 419.759 182.458 422.776C173.567 425.952 159.595 425.237 151.418 421.268Z" fill="#CD2523"/>
          <path d="M191.668 440.794C183.253 436.666 183.729 430.791 192.621 427.695C201.512 424.599 215.484 425.314 223.979 429.283C232.553 433.332 232.394 439.207 223.502 442.461C214.532 445.637 200.163 444.922 191.668 440.794Z" fill="#CD2523"/>
          <path d="M233.743 461.203C224.931 456.916 225.09 450.804 234.14 447.469C243.031 444.215 257.4 444.929 266.212 449.137C275.183 453.344 275.262 459.536 266.371 462.87C257.321 466.284 242.634 465.57 233.743 461.203Z" fill="#CD2523"/>
          <path d="M277.803 482.641C268.515 478.116 268.435 471.686 277.486 468.272C286.456 464.858 301.064 465.652 310.431 470.019C319.799 474.464 320.275 480.894 311.304 484.467C302.175 487.96 287.171 487.166 277.803 482.641Z" fill="#CD2523"/>
          <path d="M154.913 388.795C147.133 385.143 147.847 379.983 156.342 377.204C164.836 374.426 177.935 375.061 185.795 378.633C193.654 382.206 193.257 387.445 184.763 390.224C176.189 393.082 162.772 392.447 154.913 388.795Z" fill="#CD2523"/>
          <path d="M193.655 406.814C185.558 403.003 185.955 397.605 194.608 394.747C203.102 391.889 216.519 392.524 224.696 396.255C232.952 399.986 232.793 405.385 224.219 408.401C215.566 411.339 201.832 410.624 193.655 406.814Z" fill="#CD2523"/>
          <path d="M234.06 425.633C225.565 421.664 225.804 416.027 234.378 413.01C242.951 409.994 256.685 410.708 265.18 414.519C273.753 418.409 273.912 424.125 265.339 427.221C256.685 430.396 242.634 429.682 234.06 425.633Z" fill="#CD2523"/>
          <path d="M276.297 445.398C267.405 441.27 267.326 435.315 275.979 432.14C284.553 428.964 298.684 429.679 307.575 433.728C316.546 437.777 316.943 443.73 308.369 446.985C299.716 450.32 285.267 449.526 276.297 445.398Z" fill="#CD2523"/>
          <path d="M320.512 466.041C311.224 461.674 310.827 455.482 319.481 452.227C328.134 448.972 342.503 449.687 351.871 453.895C361.238 458.181 362.032 464.374 353.379 467.787C344.726 471.122 329.88 470.407 320.512 466.041Z" fill="#CD2523"/>
          <path d="M195.481 375.465C187.621 371.972 188.098 366.971 196.354 364.271C204.531 361.572 217.471 362.207 225.33 365.621C233.269 369.114 233.11 374.115 224.854 376.894C216.598 379.593 203.34 378.958 195.481 375.465Z" fill="#CD2523"/>
          <path d="M234.378 392.849C226.201 389.197 226.439 383.958 234.695 381.179C242.951 378.4 256.13 379.035 264.307 382.608C272.563 386.18 272.642 391.499 264.386 394.357C256.13 397.215 242.554 396.58 234.378 392.849Z" fill="#CD2523"/>
          <path d="M274.946 411.098C266.451 407.287 266.372 401.81 274.707 398.872C282.964 395.935 296.46 396.649 305.034 400.381C313.687 404.112 314.004 409.669 305.748 412.606C297.412 415.623 283.519 414.909 274.946 411.098Z" fill="#CD2523"/>
          <path d="M317.338 430.164C308.446 426.194 308.049 420.478 316.464 417.382C324.721 414.366 338.614 415.001 347.505 418.97C356.476 422.86 357.19 428.655 348.854 431.751C340.519 434.848 326.308 434.133 317.338 430.164Z" fill="#CD2523"/>
          <path d="M361.718 450.006C352.43 445.799 351.716 439.845 360.131 436.669C368.467 433.494 382.597 434.208 391.965 438.257C401.412 442.385 402.365 448.339 394.109 451.674C385.614 455.008 371.086 454.214 361.718 450.006Z" fill="#CD2523"/>
          <path d="M234.616 362.515C226.757 359.101 226.915 354.259 234.933 351.639C242.872 349.098 255.574 349.654 263.513 352.988C271.452 356.322 271.531 361.245 263.592 363.864C255.574 366.564 242.555 365.928 234.616 362.515Z" fill="#CD2523"/>
          <path d="M273.676 379.425C265.499 375.853 265.42 370.851 273.438 368.152C281.377 365.453 294.396 366.088 302.653 369.581C310.909 373.074 311.306 378.155 303.288 380.934C295.27 383.633 281.932 382.998 273.676 379.425Z" fill="#CD2523"/>
          <path d="M314.401 397.053C305.827 393.322 305.509 388.082 313.607 385.224C321.625 382.445 334.883 383.081 343.457 386.653C352.11 390.305 352.745 395.624 344.727 398.482C336.629 401.419 323.054 400.784 314.401 397.053Z" fill="#CD2523"/>
          <path d="M356.952 415.398C348.06 411.508 347.425 406.03 355.444 403.093C363.462 400.156 377.037 400.87 386.007 404.601C395.058 408.412 395.931 413.969 387.913 416.986C379.895 420.002 365.922 419.288 356.952 415.398Z" fill="#CD2523"/>
          <path d="M401.332 434.609C391.964 430.56 391.091 424.844 399.189 421.748C407.207 418.652 421.179 419.366 430.467 423.336C439.914 427.305 441.105 433.1 433.087 436.276C425.069 439.372 410.779 438.657 401.332 434.609Z" fill="#CD2523"/>
          <path d="M272.486 350.058C264.627 346.803 264.547 342.04 272.248 339.579C279.948 337.118 292.492 337.673 300.351 340.849C308.29 344.104 308.607 348.788 300.986 351.408C293.285 354.027 280.504 353.392 272.486 350.058Z" fill="#CD2523"/>
          <path d="M311.702 366.395C303.445 362.982 303.207 358.06 310.908 355.44C318.608 352.82 331.469 353.455 339.646 356.79C347.981 360.203 348.537 365.046 340.837 367.745C333.057 370.444 319.958 369.889 311.702 366.395Z" fill="#CD2523"/>
          <path d="M352.507 383.478C343.933 379.906 343.377 374.825 351.157 372.047C358.858 369.348 371.957 369.983 380.531 373.476C389.184 376.969 390.057 382.129 382.277 384.908C374.577 387.686 361.16 387.051 352.507 383.478Z" fill="#CD2523"/>
          <path d="M395.058 401.179C386.087 397.448 385.294 392.129 393.074 389.271C400.774 386.413 414.191 387.128 423.161 390.7C432.212 394.352 433.323 399.75 425.622 402.608C417.843 405.625 404.108 404.99 395.058 401.179Z" fill="#CD2523"/>
          <path d="M439.515 419.769C430.147 415.879 429.035 410.321 436.815 407.305C444.516 404.367 458.25 405.003 467.618 408.813C477.065 412.624 478.494 418.26 470.793 421.277C463.013 424.373 448.962 423.659 439.515 419.769Z" fill="#CD2523"/>
          <path d="M449.757 10.9929C449.757 16.55 444.279 20.6782 437.532 20.2019C430.784 19.7256 425.306 14.8035 425.227 9.24638C425.227 3.68926 430.625 -0.438917 437.373 0.0374076C444.2 0.513732 449.757 5.43579 449.757 10.9929Z" fill="#231815"/>
          <path d="M438.402 29.422L428.399 30.9304L433.163 10.2896L443.165 8.78125L438.402 29.422Z" fill="#231815"/>
          <path d="M351.155 12.1035L532 64.3406L489.924 163.257L488.337 403.722" stroke="#231815" stroke-width="1.9707" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M374.732 6.62305L510.008 42.9029C510.008 42.9029 515.565 47.825 514.454 58.8599C513.343 69.8947 507.071 70.5298 507.071 70.5298L374.811 32.0269C374.811 32.0269 369.651 31.9476 369.572 19.0075C369.413 6.1467 371.08 9.00467 374.732 6.62305Z" fill="#231815"/>
          <path d="M351.155 12.1035L314.16 106.654L311.699 327.272" stroke="#231815" stroke-width="1.9707" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M485.717 311.638L316.859 237.728L311.699 204.068L316.065 160.246L489.21 228.916L485.717 311.638Z" fill="#231815"/>
          <path d="M459.281 355.852L484.13 366.966" stroke="#231815" stroke-width="2.3765" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M316.466 292.977L340.203 303.535" stroke="#231815" stroke-width="2.3765" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div class="group">
          <div class="group-title">ロボット</div>
          <div class="item-row">
            <div class="item-labels">
              <div class="item-title">基本機能</div>
              <div class="item-desc">上位システムとしての最小限機能</div>
              <div class="quantity-selector" style="margin-top:8px;">
                <button type="button" class="quantity-btn" onclick="changeQty('robotCount', -1)">-</button>
                <input type="number" id="robotCount" min="0" value="0" class="quantity-input" />
                <button type="button" class="quantity-btn" onclick="changeQty('robotCount', 1)">+</button>
              </div>
            </div>
            <div class="item-controls" style="align-items:flex-start;">
              <span class="item-price">¥10,000/台</span>
            </div>
          </div>
          <div class="item-row">
            <div class="item-labels">
              <div class="item-title">タスク指示機能</div>
              <div class="item-desc">遠隔でタスクを指示・予約</div>
              <div class="quantity-selector" style="margin-top:8px;">
                <button type="button" class="quantity-btn" onclick="changeQty('taskAssign', -1)">-</button>
                <input type="number" id="taskAssign" min="0" value="0" class="quantity-input" />
                <button type="button" class="quantity-btn" onclick="changeQty('taskAssign', 1)">+</button>
              </div>
            </div>
            <div class="item-controls" style="align-items:flex-start;">
              <span class="item-price">+¥5,000/台</span>
            </div>
          </div>
          <div class="item-row">
            <div class="item-labels">
              <div class="item-title">優先制御機能（1台不可）</div>
              <div class="item-desc">詰まり回避の通行制御</div>
              <div class="quantity-selector" style="margin-top:8px;">
                <button type="button" class="quantity-btn" onclick="changeQty('trafficControl', -1)">-</button>
                <input type="number" id="trafficControl" min="0" value="0" class="quantity-input" />
                <button type="button" class="quantity-btn" onclick="changeQty('trafficControl', 1)">+</button>
              </div>
            </div>
            <div class="item-controls" style="align-items:flex-start;">
              <span class="item-price">+¥5,000/台</span>
            </div>
          </div>
        </div>
      </div>
      <div class="main-col">
        <svg class="main-svg" width="521" height="507" viewBox="0 0 521 507" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M314.623 506.287L302.798 503.062C300.478 502.429 299.808 499.461 301.631 497.893L423.294 393.231C424.013 392.612 424.981 392.37 425.906 392.578L512.232 411.926C515.043 412.557 515.436 416.403 512.81 417.588L316.646 506.127C316.011 506.413 315.295 506.47 314.623 506.287Z" fill="#649BAF" stroke="#649BAF" stroke-linejoin="round"/>
<path d="M302.9 104.778L1 42.0672L134.191 1L428.876 60.381L302.9 104.778Z" fill="#E6E5DE" stroke="#E6E5DE" stroke-linejoin="round"/>
<path d="M61.491 423.882L44.2871 428.32V136.41L61.491 139.185V423.882Z" fill="#597683" stroke="#597683" stroke-linejoin="round"/>
<path d="M158.767 160.932L157.12 449.097L63.543 422.744L62.9941 140.485L158.767 160.932Z" fill="#8AA0AA" stroke="#395663" stroke-width="3"/>
<path d="M255.33 188.125L253.684 476.29L160.106 449.938L159.558 167.679L255.33 188.125Z" fill="#8AA0AA" stroke="#395663" stroke-width="3"/>
<path d="M1.55496 417.776L1 42.0664L302.345 104.777V501.575L254.063 487.146V180.807L44.2871 135.3V428.32L1.55496 417.776Z" fill="#F0EDE8" stroke="#F0EDE8" stroke-linejoin="round"/>
<path d="M121.641 96.6368V131.637M121.641 96.6368L106.998 108.383M121.641 96.6368L136.284 114.891" stroke="#6F8389" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M162.641 140.748V105.748M162.641 140.748L147.998 122.494M162.641 140.748L177.284 129.002" stroke="#6F8389" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
<rect x="0.488094" y="0.608465" width="26.7481" height="54.4963" rx="4.5" transform="matrix(0.976187 0.21693 0 1 264.619 292.25)" fill="#AEBBBF"/>
<rect x="0.488094" y="0.608465" width="26.7481" height="54.4963" rx="4.5" transform="matrix(0.976187 0.21693 0 1 264.619 292.25)" stroke="#AEBBBF"/>
<circle cx="6.5" cy="6.5" r="6.5" transform="matrix(0.976187 0.21693 0 1 271.807 315.203)" fill="#6E8088"/>
<path d="M64.8203 140.295L253.508 181.362V196.901L64.8203 156.389V140.295Z" fill="#607B88"/>
<path d="M302.9 501.576V104.778L428.877 60.3809L429.432 446.08L302.9 501.576Z" fill="#ADB6B8" stroke="#ADB6B8" stroke-linejoin="round"/>
</svg>
        <div class="group">
          <div class="group-title">設備</div>
          <div class="item-row">
            <div class="item-labels">
              <div class="item-title">外部設備連携ー簡易型</div>
              <div class="item-desc">自動ドア・シャッターなど</div>
              <div class="quantity-selector" style="margin-top:8px;">
                <button type="button" class="quantity-btn" onclick="changeQty('simpleDevice', -1)">-</button>
                <input type="number" id="simpleDevice" min="0" value="0" class="quantity-input" />
                <button type="button" class="quantity-btn" onclick="changeQty('simpleDevice', 1)">+</button>
              </div>
            </div>
            <div class="item-controls" style="align-items:flex-start;">
              <span class="item-price">+¥5,000/台</span>
            </div>
          </div>
          <div class="item-row">
            <div class="item-labels">
              <div class="item-title">外部設備連携ー複雑型</div>
              <div class="item-desc">エレベーターなど</div>
              <div class="quantity-selector" style="margin-top:8px;">
                <button type="button" class="quantity-btn" onclick="changeQty('complexDevice', -1)">-</button>
                <input type="number" id="complexDevice" min="0" value="0" class="quantity-input" />
                <button type="button" class="quantity-btn" onclick="changeQty('complexDevice', 1)">+</button>
              </div>
            </div>
            <div class="item-controls" style="align-items:flex-start;">
              <span class="item-price">+¥10,000/台</span>
            </div>
          </div>
        </div>
      </div>
    </div>    <div class="note-card">
      <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5"/><rect x="11" y="10" width="2" height="6" rx="1" fill="currentColor"/><rect x="11" y="7" width="2" height="2" rx="1" fill="currentColor"/></svg>
      <div>他システムとの連携（例：自動倉庫、在庫管理システムなど）につきましては、<strong>価格は別途ご相談となります</strong>。</div>
    </div>
    
    <!-- 结果区域 -->
    <div id="resultsPanel" class="results-panel">
      <div class="results-title">LINK ランニング費用</div>
      <div id="resultsItems">
        <!-- 动态生成的项目将在这里显示 -->
      </div>
      <div class="results-item total">
        <span>合計</span>
        <span id="resultsTotalPrice">¥0</span>
      </div>
      <button id="exportExcelBtn" class="quantity-btn" style="margin-top: 20px; width: 100%; font-size:1.1em; padding: 8px 24px; border-radius: 8px; background:#0071e3; color:#fff; border:none; cursor:pointer; display: flex; align-items: center; justify-content: center;">
        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px; vertical-align: text-bottom;">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>明細を出力
      </button>
    </div>
  </div>  <!-- 追加：通知提示 -->
  <div id="notification" class="notification hidden">
    <div class="notification-icon">
      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
    </div>
    <div id="notification-message" class="notification-message">通知内容</div>
  </div>
  <script>
    const robot = document.getElementById('robotCount');
    const task = document.getElementById('taskAssign');
    const traffic = document.getElementById('trafficControl');
    const simple = document.getElementById('simpleDevice');
    const complex = document.getElementById('complexDevice');
    const resultsPanel = document.getElementById('resultsPanel');
    const resultsItems = document.getElementById('resultsItems');
    const resultsTotalPrice = document.getElementById('resultsTotalPrice');
    const exportBtn = document.getElementById('exportExcelBtn');
    const notification = document.getElementById('notification');
    const notificationMessage = document.getElementById('notification-message');

    // 保存初始值，用于确定用户是否有修改
    const initialValues = {
      robot: 0,
      task: 0,
      traffic: 0,
      simple: 0,
      complex: 0
    };
    
    // 显示通知函数
    function showNotification(message) {
      notificationMessage.textContent = message;
      notification.classList.remove('hidden');
      notification.classList.add('show');
      
      // 3秒后自动隐藏
      setTimeout(() => {
        notification.classList.remove('show');
        notification.classList.add('hidden');
      }, 5000);
    }

    function calculate() {
      const rc = parseInt(robot.value) || 0;
      let taskc = parseInt(task.value) || 0;
      let trafficc = parseInt(traffic.value) || 0;
      const sc = parseInt(simple.value) || 0;
      const cc = parseInt(complex.value) || 0;

      // 限制：タスク指示機能和優先制御機能不能高于基本機能
      if (taskc > rc) {
        task.value = rc;
        taskc = rc;
        showNotification('タスク指示機能はロボット基台数本機能の台数を超えることはできません。');
      }
      if (trafficc > rc) {
        traffic.value = rc;
        trafficc = rc;
        showNotification('優先制御機能はロボット基本機能の台数を超えることはできません。');
      }

      // 1. 基本機能归零，其他机器人功能也归零
      if (rc === 0) {
        task.value = 0;
        traffic.value = 0;
        taskc = 0;
        trafficc = 0;
        task.disabled = true;
        traffic.disabled = true;
      } else {
        task.disabled = false;
        // 2. 優先制御機能的前提是基本機能>=2
        if (rc <= 1) {
          traffic.value = 0;
          trafficc = 0;
          traffic.disabled = true;
        } else {
          traffic.disabled = false;
        }
      }

      // 计算总价
      let price = 0;
      price += rc * 10000;
      price += taskc * 5000;
      price += trafficc * 5000;
      price += sc * 5000;
      price += cc * 10000;      // 生成详细项目列表，按分组显示
      let itemsHtml = '';
      
      // 判断是否有机器人相关项目
      if (rc > 0 || taskc > 0 || trafficc > 0) {
        itemsHtml += '<div class="results-group">';
        itemsHtml += '<div class="results-group-title">ロボット</div>';
        
        if (rc > 0) {
          itemsHtml += createResultItem('基本機能', `${rc}台`, `¥${(rc * 10000).toLocaleString()}`);
        }
        
        if (taskc > 0) {
          itemsHtml += createResultItem('タスク指示機能', `${taskc}台`, `¥${(taskc * 5000).toLocaleString()}`);
        }
        
        if (trafficc > 0) {
          itemsHtml += createResultItem('優先制御機能', `${trafficc}台`, `¥${(trafficc * 5000).toLocaleString()}`);
        }
        
        itemsHtml += '</div>'; // 结束机器人分组
      }
      
      // 判断是否有设备相关项目
      if (sc > 0 || cc > 0) {
        itemsHtml += '<div class="results-group">';
        itemsHtml += '<div class="results-group-title">設備</div>';
        
        if (sc > 0) {
          itemsHtml += createResultItem('標準制御設備', `${sc}台`, `¥${(sc * 5000).toLocaleString()}`);
        }
        
        if (cc > 0) {
          itemsHtml += createResultItem('高度制御設備', `${cc}台`, `¥${(cc * 10000).toLocaleString()}`);
        }
        
        itemsHtml += '</div>'; // 结束设备分组
      }
      
      resultsItems.innerHTML = itemsHtml;
      resultsTotalPrice.textContent = `¥${price.toLocaleString()}`;
      
      // 显示或隐藏结果面板：当用户修改了任何数量（不全为0）时显示
      const hasChanges = (rc > 0 || taskc > 0 || trafficc > 0 || sc > 0 || cc > 0);
      if (hasChanges) {
        resultsPanel.style.display = 'flex';
      } else {
        resultsPanel.style.display = 'none';
      }
    }
    
    function createResultItem(name, count, price) {
      return `
        <div class="results-item">
          <span>${name} ${count}</span>
          <span>${price}</span>
        </div>
      `;
    }

    function changeQty(id, delta) {
      const input = document.getElementById(id);
      let val = parseInt(input.value) || 0;
      // 特殊处理：優先制御機能（trafficControl）无法为1
      if (id === 'trafficControl') {
        const robotVal = parseInt(document.getElementById('robotCount').value) || 0;
        if (delta > 0) {
          if (robotVal === 2 && val === 0) {
            val = 2; // 直接跳到2
          } else {
            val += delta;
            if (val === 1) val = 2; // 跳过1
          }
        } else if (delta < 0) {
          if (val === 2) {
            val = 0; // 直接归零
          } else {
            val += delta;
            if (val === 1) val = 0; // 跳过1
            if (val < 0) val = 0;
          }
        }
        // 限制最大值不能超过基本機能
        if (val > robotVal) {
          val = robotVal;
          showNotification('優先制御機能はロボット基本機能の台数を超えることはできません。');
        }
        // 检查机器人数量是否足够
        if (robotVal <= 1 && val > 0) {
          val = 0;
          showNotification('優先制御機能を利用するには、最低2台以上のロボットが必要です。');
        }
      } else if (id === 'taskAssign') {
        const robotVal = parseInt(document.getElementById('robotCount').value) || 0;
        val += delta;
        if (val < 0) val = 0;
        // 限制最大值不能超过基本機能
        if (val > robotVal) {
          val = robotVal;
          showNotification('タスク指示機能はロボット基本機能の台数を超えることはできません。');
        }
        // 检查机器人数量是否为0
        if (robotVal === 0 && val > 0) {
          val = 0;
          showNotification('タスク指示機能を利用するには、まずロボット基本機能を設定してください。');
        }
      } else if (id === 'robotCount') {
        val += delta;
        if (val < 0) val = 0;
        
        // 检查是否影响タスク指示機能
        const taskVal = parseInt(document.getElementById('taskAssign').value) || 0;
        if (val < taskVal) {
          document.getElementById('taskAssign').value = val;
          if (val === 0) {
            showNotification('ロボット基本機能がゼロの場合、タスク指示機能も利用できません。');
          } else {
            showNotification('タスク指示機能はロボット基本機能の台数を超えることはできません。');
          }
        }
        
        // 检查是否影响優先制御機能
        const trafficVal = parseInt(document.getElementById('trafficControl').value) || 0;
        if (val <= 1 && trafficVal > 0) {
          document.getElementById('trafficControl').value = 0;
          showNotification('優先制御機能を利用するには、最低2台以上のロボットが必要です。');
        } else if (val < trafficVal) {
          document.getElementById('trafficControl').value = val;
          showNotification('優先制御機能はロボット基本機能の台数を超えることはできません。');
        }
      } else {
        val += delta;
        if (val < 0) val = 0;
      }
      input.value = val;
      input.dispatchEvent(new Event('input'));
    }

    // 为優先制御機能添加特殊的输入限制，防止手动输入数字"1"
    traffic.addEventListener('input', function(e) {
      const val = parseInt(e.target.value) || 0;
      const robotVal = parseInt(robot.value) || 0;
      
      if (val === 1) {
        // 如果用户输入1，自动调整为0
        e.target.value = 0;
        showNotification('優先制御機能では「1」は設定できません。最低2台から利用可能です。');
      } else if (val > robotVal) {
        // 如果超过机器人数量
        e.target.value = robotVal;
        showNotification('優先制御機能はロボット基本機能の台数を超えることはできません。');
      } else if (robotVal <= 1 && val > 0) {
        // 如果机器人数量不足
        e.target.value = 0;
        showNotification('優先制御機能を利用するには、最低2台以上のロボットが必要です。');
      }
    });
    
    // 为タスク指示機能添加输入限制
    task.addEventListener('input', function(e) {
      const val = parseInt(e.target.value) || 0;
      const robotVal = parseInt(robot.value) || 0;
      
      if (val > robotVal) {
        e.target.value = robotVal;
        showNotification('タスク指示機能はロボット基本機能の台数を超えることはできません。');
      } else if (robotVal === 0 && val > 0) {
        e.target.value = 0;
        showNotification('タスク指示機能を利用するには、まずロボット基本機能を設定してください。');
      }
    });
    
    // 为ロボット基本機能添加输入限制
    robot.addEventListener('input', function(e) {
      const val = parseInt(e.target.value) || 0;
      const taskVal = parseInt(task.value) || 0;
      const trafficVal = parseInt(traffic.value) || 0;
      
      if (val < taskVal) {
        task.value = val;
        task.dispatchEvent(new Event('input'));
        showNotification('タスク指示機能はロボット基本機能の台数を超えることはできません。');
      }
      
      if (val <= 1 && trafficVal > 0) {
        traffic.value = 0;
        traffic.dispatchEvent(new Event('input'));
        showNotification('優先制御機能を利用するには、最低2台以上のロボットが必要です。');
      } else if (val < trafficVal) {
        traffic.value = val;
        traffic.dispatchEvent(new Event('input'));
        showNotification('優先制御機能はロボット基本機能の台数を超えることはできません。');
      }
    });

    [robot, task, traffic, simple, complex].forEach(input => {
      input.addEventListener('input', calculate);
      input.addEventListener('change', calculate);
    });

    calculate(); // 初期計算

    document.getElementById('exportExcelBtn').addEventListener('click', function() {
      // 采集数据
      const rc = parseInt(robot.value)||0;
      const taskc = parseInt(task.value)||0;
      const trafficc = parseInt(traffic.value)||0;
      const sc = parseInt(simple.value)||0;
      const cc = parseInt(complex.value)||0;
      
      // 获取当前日期格式化为 yyyy-MM-dd
      const today = new Date();
      const yyyy = today.getFullYear();
      const MM = String(today.getMonth() + 1).padStart(2, '0');
      const dd = String(today.getDate()).padStart(2, '0');
      const formattedDate = `${yyyy}-${MM}-${dd}`;
      
      // 创建工作簿和工作表
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.aoa_to_sheet([
        ['LINK ランニング費用', '', ''],
        ['', '', ''],
        ['ロボット', '', ''],
        ['基本機能', `${rc}台`, `¥${(rc * 10000).toLocaleString()}`],
        ['タスク指示機能', `${taskc}台`, `¥${(taskc * 5000).toLocaleString()}`],
        ['優先制御機能', `${trafficc}台`, `¥${(trafficc * 5000).toLocaleString()}`],
        ['', '', ''],
        ['設備', '', ''],
        ['標準制御設備', `${sc}台`, `¥${(sc * 5000).toLocaleString()}`],
        ['高度制御設備', `${cc}台`, `¥${(cc * 10000).toLocaleString()}`],
        ['', '', ''],
        ['合計', '', `¥${((rc * 10000) + (taskc * 5000) + (trafficc * 5000) + (sc * 5000) + (cc * 10000)).toLocaleString()}`]
      ]);
      
      // 设置列宽
      ws['!cols'] = [{ wch: 25 }, { wch: 15 }, { wch: 15 }];
      
      // 添加工作表到工作簿
      XLSX.utils.book_append_sheet(wb, ws, "LINK費用");
      
      // 生成二进制数据
      const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'binary' });
      
      // 转换二进制数据为Blob
      function s2ab(s) {
        const buf = new ArrayBuffer(s.length);
        const view = new Uint8Array(buf);
        for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
        return buf;
      }
      
      // 创建Blob对象并下载
      const blob = new Blob([s2ab(wbout)], { type: 'application/octet-stream' });
      
      // 创建一个隐藏的 a 元素用于下载
      const a = document.createElement('a');
      a.href = window.URL.createObjectURL(blob);
      a.download = `LINK ランニング費用 ${formattedDate}.xlsx`;
      document.body.appendChild(a);
      a.click();
      
      // 清理
      setTimeout(() => {
        document.body.removeChild(a);
        window.URL.revokeObjectURL(a.href);
      }, 0);
    });
  </script>
</body>
</html>
